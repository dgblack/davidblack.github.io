<!DOCTYPE html>
<html>
<head>
<title>David Black Portfolio</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="noindex">
<link rel="stylesheet" href="w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif;}
body, html {
  height: 100%;
  color: #777;
  line-height: 1.8;
}

/* Create a Parallax Effect */
.bgimg-1 {
  background-attachment: fixed;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
}

/* First image (Logo. Full height) */
.bgimg-1 {
  background-image: url('images/sigurd.jpg');
  min-height: 100%;
}

.w3-wide {letter-spacing: 10px;}
.w3-hover-opacity {cursor: pointer;}

/* Turn off parallax scrolling for tablets and phones */
@media only screen and (max-device-width: 1600px) {
  .bgimg-1 {
    background-attachment: scroll;
    min-height: 400px;
  }
}
</style>
</head>
<body>

<!-- Navbar (sit on top) -->
<div class="w3-top">
  <div class="w3-bar" id="myNavbar">
    <a class="w3-bar-item w3-button w3-hover-black w3-hide-medium w3-hide-large w3-right" href="javascript:void(0);" onclick="toggleFunction()" title="Toggle Navigation Menu">
      <i class="fa fa-bars"></i>
    </a>
    <a href="index.html" class="w3-bar-item w3-button">HOME</a>
    <a href="index.html#about" class="w3-bar-item w3-button w3-hide-small"><i class="fa fa-user"></i> ABOUT</a>
    <a href="index.html#cv" class="w3-bar-item w3-button w3-hide-small"><i class="fa fa-th"></i> CV</a>
    <a href="adventure.html" class="w3-bar-item w3-button w3-hide-small"><i class="fa fa-map-o"></i> ADVENTURE</a>
    <a href="index.html#contact" class="w3-bar-item w3-button w3-hide-small"><i class="fa fa-envelope"></i> CONTACT</a>
    <a href="#" class="w3-bar-item w3-button w3-hide-small w3-right w3-hover-red">
      <i class="fa fa-search"></i>
    </a>
  </div>

  <!-- Navbar on small screens -->
  <div id="navDemo" class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium">
    <a href="index.html#about" class="w3-bar-item w3-button" onclick="toggleFunction()">ABOUT</a>
    <a href="index.html#cv" class="w3-bar-item w3-button" onclick="toggleFunction()">CV</a>
    <a href="adventure.html" class="w3-bar-item w3-button" onclick="toggleFunction()">ADVENTURE</a>
    <a href="index.html#contact" class="w3-bar-item w3-button" onclick="toggleFunction()">CONTACT</a>
    <a href="#" class="w3-bar-item w3-button">SEARCH</a>
  </div>
</div>

<!-- First Parallax Image with Logo Text -->
<div class="bgimg-1 w3-display-container w3-opacity-min" id="home">
  <div class="w3-display-middle" style="white-space:nowrap;">
    <span class="w3-center w3-padding-large w3-black w3-xlarge w3-wide w3-animate-opacity">HUMAN <span class="w3-hide-small"></span> TELEOPERATION</span>
  </div>
</div>

<!-- Container (Wiki Section) -->
<div class="w3-content w3-container w3-padding-64" id="contents">
  <h2 id="human-teleop-wiki">Human Teleoperation Wiki</h1>
  <h5 id="version-date">Updated: April 26, 2024</h5>

  <h4 id="intro">Introduction and Contents</h5>
  <p>Intro and contents</p>
  <p>This page contains some demo videos and video walkthroughs of the system, how to build, deploy, etc.. The last section also contains some tips and tricks for using the system, as well as some of the known issues. Here is a general, introductory demo video:</p>
  <h3>Contents:</h3>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/hwCLHIzUBlI?si=XAB_LWwjX6r-QSXR" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  <p><a href="#expert" class="w3-bar-item w3-button" onclick="toggleFunction()">Expert Side</a></p>
  <p><a href="#follower" class="w3-bar-item w3-button" onclick="toggleFunction()">Follower Side</a></p>
  <p><a href="#android" class="w3-bar-item w3-button" onclick="toggleFunction()">Android and Force Sensor</a></p>
  <p><a href="#communication" class="w3-bar-item w3-button" onclick="toggleFunction()">Communication</a></p>
  <p><a href="#haptics" class="w3-bar-item w3-button" onclick="toggleFunction()">Haptics</a></p>
  <p><a href="#issues" class="w3-bar-item w3-button" onclick="toggleFunction()">Tips and Known Issues</a></p>
</div>
<div class="w3-content w3-container w3-padding-64" id="system">
  <h4 id="expert-app">Running the System</h5>
  <p>This section describes how to run the system and access its features. The following video shows some of the main features.</p>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/mUqgag4UBv4?si=5OENQ_3DSp-lHO0M" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  <p> The general startup procedure is as follows:</p>
  <ul>
    <li>
      Set up Android and force sensor
      <ul>
        <li>Turn on the Android phone and open the MiRTHUS_Android app.</li> 
        <li>Plug in the force sensor and allow the permission</li>
        <li>Press the reset button on the force sensor (the button closer to the probe face). You will need something like an Allen key to reach the button.</li>
        <li>In a few seconds, a USB icon and a green dot should appear on the Android app, and force readings should appear.</li>
        <li>If the probe wasn't held upright and not contacting anything during this procedure, hold it thus and long press the USB icon to bias it. You can also do this throughout the test whenever it needs biasing.</li>
        <li>If it is necessary to change the communication ID or ultrasound probe type, hit the big green on button and select end service. Then hit the settings icon and enter the communication ID. Hit OK to confirm. You can choose the probe type from the dropdown. This affects the force sensor calibration. Hit Exit Settings to return to the main screen, and press the on butotn again to restart the service.</li>
      </ul>
    </li>
    <li>
      Set up ultrasound stream
      <ul>
        <li>Plug ultrasound probe into the Android tablet and open the Lumify app</li>
        <li>Open Windows Phone Link on the expert PC and connect to the tablet</li>
        <li>The follower has to accept the start recording notification on the tablet</li>
      </ul>
    </li>
    <li>
      Set up the HoloLens 2.
       <ul>
        <li>Turn on the HoloLens and open the MiRTHUS_CV app</li>
        <li>Place the ultrasound probe flat on the patient, with its face at midline, close to the base of the ribs, and with the face of the probe pointing to the patient's head, and the IR markers pointing to the patient's feet. Make sure you can see the IR markers. Once the alignment is good, press the confirm button. The confirm button should be upright and facing you if you have the right alignment.</li>
        <li>The HoloLens should connect to the communication. The red dot on the side of the settings menu should turn green, and a HoloLens icon should appear on the Android app</li>
       </ul>
    </li>
    <li>
      Set up the expert side
      <ul>
        <li>Open HumanTeleop.exe and press Run in the top left. The HoloLens video stream should immediately start and the haptic device should move up a little and stay there</li>
        <li>Switch the control mode to the desired mode and start the teleoperation</li>
      </ul>
    </li>
    <li>
      Finishing the test
      <ul>
        <li>Press escape to exit the expert app. It should put down the haptic device gently and exit cleanly. The log file will appear on the desktop with the current date and the time that the app was started.</li>
        <li>On the HoloLens, exit the app by going to the home screen and closing the MiRTHUS_CV window.</li>
        <li>On the Android phone, quit the app and unplug the force sensor.</li>
        <li>Stop the screen recording on the expert PC and save it with the log file</li>
        <li>On the ultrasound probe, click "End Exam", review the images and measurements, and exprt the test to file. Make sure the image resolution is good and you know where the files are. Save these with the log file and screen recording</li>
      </ul>
    </li>
  </ul>
  <p>During tests, we want to collect all possible data. Currently, I have the expert side application set up to save all the kinematic and force data in a log file, along with some debugging information. The log file is organized as follows:</p>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/fegXM3cm2zU?si=zOe38WpivpGgn-K_" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  <p>To record the ultrasound image, we should do a screen recording of the Android screen stream. Unfortunately, we do not have direct access to the ultrasound image otherwise. Additionally, it would be useful to record the patient mesh and pose so the measured probe poses are referenced to the patient anatomy. Finally, we should pipe the HoloLens video stream to a video file as well, to save what the follower sees.</p>
</div>
<div class="w3-content w3-container w3-padding-64" id="expert">
  <h4 id="expert-app">Expert Side App</h5>
  <p>The expert side application is written in C++ and based on the Qt framework for the UI. It uses OpenHaptics SDK to control the haptic device, and WebRTC (libdatachannel) for the communication, as well as some other libraries. The build process is through CMake, as shown below:</p>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/2mVO5zBRP8Q?si=doOhfAgJfy0wIYtK" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  <p>On first startup, you will have to select some settings, but these are saved to a file so the expert does not have to set them every time they open the app:</p>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/1pBCrsaFSDI?si=7mTrqwsgal6PeUiz" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  <p>The main complexity of the expert side lies in the haptic feedback algorithms, of which I've tried quite a few. These are described in the <a href="#haptics">haptics</a> section below. Some important notes:</p>
  <ul>
    <li>The expert side occasionally crashes when the Android disconnects. It has something to do with how the communication is stopped and restarted when this happens</li>
    <li>After some minutes, the communication sometimes becomes extremely laggy, with delays of more than a second. This is noticeable in the video stream and the motions of the virtual probe, and renders force feedback impossible. Simply restarting the expert side rectifies this immediately. Possibly, hitting Stop and the Start again to restart the communication also does the trick.</li>
    <li>Use a fan pointing at the haptic device to avoid overheating, and try to reduce the amount of force being applied at any time. If the force exceeds 6-7 N, the haptic device saturates or pops through. There is a bar on the side of the expert app that shows how close the force is to saturating.</li>
    <li>The haptic device works best when laid on its side, on the right-hand side of the expert. This way we avoid a lot of annoying singularities and greatly improve the workspace. Position it so the SensAble Technologies logo on the main joint faces up, the device is in front and to the right of the expert, and the back plate of the device points perpendicular to the expert's monitor. If for some reason it has to be used in its normal configuration, comment out the LAYING_ON_SIDE constant in QtHaptics.h.</li>
  </ul>
</div>
<div class="w3-content w3-container w3-padding-64" id="follower">
  <h4 id="follower-app">Follower Side App</h5>
  <p>Follower side app and building</p>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/fmZWqbRMFps?si=eCbsPzFbDejG2GXs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div>
<div class="w3-content w3-container w3-padding-64" id="android">
  <h4 id="android-apps">Force Sensor and Android Applications</h5>
  <p>Android app and Lumify</p>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/YYQFddBCn6Q?si=lNhQeY0STawCl42_" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div>
<div class="w3-content w3-container w3-padding-64" id="communication">
  <h4 id="comms">Communication</h5>
  <p>Communication architecture</p>
</div>
<div class="w3-content w3-container w3-padding-64" id="haptics">
  <h4 id="haptics-header">Haptics</h5>
  <p>Describe the haptics. Ellipsoid controller:</p>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/BlAXUXhezHs?si=fik1nWiBk-Diu-dZ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  <p>Other haptics:</p>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/p6IcUb3AKjM?si=YmDdO9b0aZJBFvc1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  <p>Surface toggling:</p>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/7RLmrRqmWok?si=KbmXxehQEIBkKFo6" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  <p>Clutching:</p>
  <iframe width="560" height="315" src="https://www.youtube.com/embed/0UFLtJTKFRI?si=QK3-MzVec7TuRXYW" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div>
</div>
<div class="w3-content w3-container w3-padding-64" id="issues">
  <h4 id="issues-header">Tips and Known Issues</h5>
  <p>Describe the known issues and some common tips/tricks</p>
</div>
</div>
  
<!-- Footer -->
<footer class="w3-center w3-black w3-padding-64 w3-opacity w3-hover-opacity-off">
  <a href="#home" class="w3-button w3-light-grey"><i class="fa fa-arrow-up w3-margin-right"></i>To the top</a>
  <div class="w3-xlarge w3-section">
    <a href="https://github.com/dgblack"><i class="fa fa-github w3-hover-opacity"></i></a>
    <a href="https://scholar.google.com/citations?user=As_yDKkAAAAJ&hl=en"><i class="fa fa-google w3-hover-opacity"></i></a>
    <a href="https://twitter.com/BlackDavidG"><i class="fa fa-twitter w3-hover-opacity"></i></a>
    <a href="https://linkedin.com/in/davidgblack"><i class="fa fa-linkedin w3-hover-opacity"></i></a>
  </div>
  <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS" target="_blank" class="w3-hover-text-green">w3.css</a></p>
</footer>
 
<script>
// Modal Image Gallery
function onClick(element) {
  document.getElementById("img01").src = element.src;
  document.getElementById("modal01").style.display = "block";
  var captionText = document.getElementById("caption");
  captionText.innerHTML = element.alt;
}

// Change style of navbar on scroll
window.onscroll = function() {myFunction()};
function myFunction() {
    var navbar = document.getElementById("myNavbar");
    if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
        navbar.className = "w3-bar" + " w3-card" + " w3-animate-top" + " w3-white";
    } else {
        navbar.className = navbar.className.replace(" w3-card w3-animate-top w3-white", "");
    }
}

// Used to toggle the menu on small screens when clicking on the menu button
function toggleFunction() {
    var x = document.getElementById("navDemo");
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
    } else {
        x.className = x.className.replace(" w3-show", "");
    }
}
</script>
</body>
</html>
